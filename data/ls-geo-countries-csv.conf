input {
    file {
        path => ["<WORK_DIR>/tp-elastic/data/countries_of_the_world-geo-v2.csv"]
        start_position => "beginning"
        sincedb_path => "/dev/null"
    }
}

filter {
    csv {
      columns => [
      "code",
			"country",
			"region",
			"population",
			"area",
			"pop_density",
			"coastline",
			"net_migration",
			"infant_mortality",
			"gdp",
			"literacy",
			"phones",
			"arable",
			"crops",
			"other",
			"climate",
			"birthrate",
			"deathrate",
			"agriculture",
			"industry",
			"service",
      "latitude",
      "longitude"
        ] 

      skip_header => true

		  remove_field => ["message","host","path"]     	     	
    }

  mutate {
    gsub => [
        "pop_density", ",", ".",
        "coastline", ",", ".",
        "net_migration", ",", ".",
        "infant_mortality", ",", ".",
        "literacy", ",", ".",
        "phones", ",", ".",
        "arable", ",", ".",
        "crops", ",", ".",
        "other", ",", ".",
        "birthrate", ",", ".",
        "deathrate", ",", ".",
        "agriculture", ",", ".",
        "industry", ",", ".",
        "service", ",", ".",
        "latitude", ",", ".",
        "longitude", ",", "."        
    ]
  }

  mutate {
    add_field => [ "[location][lat]", "%{latitude}"]
    add_field => [ "[location][lon]", "%{longitude}"]
  } 


  mutate {
    convert =>{
      "latitude" => "float"
      "longitude" => "float"
    }
  }  




  mutate {
    convert =>{
      "[location]" => "float"
    }
  }   
  


	mutate {
     	convert => {
			"population" => "integer"
			"area" => "integer"
			"pop_density" => "float"
  			"coastline" => "float"
  			"net_migration" => "float"
  			"infant_mortality" => "float"
			"gdp" => "integer" 			
  			"literacy" => "float"
  			"phones" => "float"
  			"arable" => "float"
  			"crops" => "float"
  			"other" => "float"
  			"birthrate" => "float"
  			"deathrate" => "float"
  			"agriculture" => "float"
  			"industry" => "float"
			"service" => "float"
     	}		
	}	

}


output {
    stdout { codec => rubydebug }
    elasticsearch {
        action => "index"
        hosts => ["localhost:9200"]
        index => "tp_kib_countries"
        workers => 1
    }
}
